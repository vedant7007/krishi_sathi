# KrishiSathi - Smart Farming Companion

KrishiSathi is a mobile-first web application built to help Indian farmers access real-time agricultural information through voice, text, and phone calls - in their own language.

Built for the hackathon by a team that believes technology should speak the farmer's language, not the other way around.

## What it does

Indian farmers face a gap between available agricultural data and their ability to access it. KrishiSathi bridges that gap:

- **Voice AI Agent** - Farmers speak in Hindi, Telugu, or English and get instant farming advice powered by AI. No typing needed.
- **Phone Call Support** - A "Call Me" button triggers an actual phone call from KrishiSathi. The farmer picks up and talks to the AI agent over the phone. Works on any phone, no internet required for the call itself.
- **Crop Advisory** - Select your crop, soil type, and season to get detailed advice on fertilizer, irrigation, pest control, sowing, and harvesting. Generated by AI when database entries don't exist.
- **Emergency Alerts** - Admins can broadcast flood, drought, cyclone, and pest outbreak warnings to farmers via SMS, WhatsApp, and voice calls simultaneously.
- **Weather Dashboard** - Current conditions, 5-day forecast, temperature trends, and farming-specific recommendations based on weather data.
- **Market Prices** - Live mandi prices for crops across Indian markets so farmers know what their produce is worth before selling.
- **Government Schemes** - Curated list of schemes like PM-KISAN, crop insurance, and subsidies with eligibility checks based on the farmer's profile.
- **News Feed** - Agriculture news relevant to the farmer's region and crops.

## Tech Stack

**Frontend**
- React 18 + Vite
- Tailwind CSS (mobile-first, PWA-ready)
- React Router, i18next for multilingual support
- Recharts for data visualization
- LiveKit client for real-time voice
- WebAuthn (biometric login) via SimpleWebAuthn

**Backend**
- Node.js + Express
- MongoDB + Mongoose
- JWT authentication + WebAuthn/FIDO2

**AI & Voice**
- Google Gemini (crop advisory generation, voice agent brain, translations)
- Google Translate (free fallback when Gemini is rate-limited)
- Deepgram (speech-to-text streaming)
- Murf AI / Deepgram (text-to-speech)
- LiveKit (real-time voice rooms)

**Communication**
- Twilio (SMS, WhatsApp, voice calls, IVR)
- TwiML-based IVR with speech recognition for phone-based interaction

**APIs**
- OpenWeatherMap (weather data)
- data.gov.in (market prices)

## How the Voice System Works

This is the core of KrishiSathi and worth explaining:

1. **In-App Voice**: Farmer taps the mic -> Deepgram streams speech-to-text -> text goes to Gemini AI with full farmer context (crop, location, weather, prices) -> AI responds in farmer's language -> Murf/Deepgram converts to speech -> farmer hears the answer.

2. **Phone Call ("Call Me")**: Farmer taps "Call Me" -> server triggers Twilio outbound call -> farmer's phone rings -> Twilio IVR collects speech -> sends to our webhook -> AI generates response -> Twilio speaks it back using `<Say>`. The farmer can have a full conversation with the AI over a regular phone call.

3. **Emergency Broadcast**: Admin creates alert -> server sends SMS, WhatsApp messages, and/or voice calls to all farmers in affected districts simultaneously using Twilio.

## Languages

Everything works in three languages:
- English
- Hindi
- Telugu

The language is set during registration and persists across sessions. Crop advisory, schemes, news, and the voice agent all respond in the farmer's chosen language.

## Project Structure

```
KrishiSathi/
├── client/                   # React frontend
│   ├── src/
│   │   ├── components/       # Reusable components (AppLogo, CallMeButton, VoiceAgent, etc.)
│   │   ├── context/          # FarmContext (global state, auth, language)
│   │   ├── i18n/             # Translation files (en, hi, te)
│   │   ├── pages/            # All page components
│   │   ├── services/         # API service modules
│   │   └── utils/            # Translation helpers, formatters
│   └── public/               # PWA manifest, service worker, icons
│
├── server/                   # Express backend
│   ├── controllers/          # Route handlers
│   │   ├── advisoryController.js    # Crop advisory (DB + AI generation)
│   │   ├── emergencyController.js   # Alert broadcasting
│   │   ├── voiceAgentController.js  # In-app voice + Call Me + TTS
│   │   └── voiceIVRController.js    # Twilio phone IVR flow
│   ├── middleware/            # Auth, rate limiting, error handling
│   ├── models/                # Mongoose schemas
│   ├── routes/                # Express route definitions
│   └── utils/
│       ├── gemini.js          # Gemini AI, Google Translate, advisory generation
│       ├── twilio.js          # SMS, WhatsApp, voice call utilities
│       ├── farmerContext.js   # Loads farmer's full context for AI
│       └── voiceConfig.js    # Voice/language config for TTS and IVR
```

## Setup

### Prerequisites
- Node.js 18+
- MongoDB (Atlas or local)
- API keys for: Gemini, Twilio, OpenWeatherMap, Deepgram

### Environment Variables

Create `server/.env`:

```env
PORT=5000
MONGODB_URI=your_mongodb_connection_string
JWT_SECRET=your_jwt_secret
JWT_EXPIRE=7d

# AI (Gemini)
GEMINI_API_KEY=your_gemini_key

# Weather
OPENWEATHER_API_KEY=your_openweather_key

# Voice
DEEPGRAM_API_KEY=your_deepgram_key
MURF_API_KEY=your_murf_key
LIVEKIT_URL=wss://your-livekit-instance.livekit.cloud
LIVEKIT_API_KEY=your_livekit_key
LIVEKIT_API_SECRET=your_livekit_secret

# Twilio
TWILIO_ACCOUNT_SID=your_twilio_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1xxxxxxxxxx
TWILIO_WHATSAPP_NUMBER=whatsapp:+14155238886

# Must be your public deployment URL (not localhost) for Twilio callbacks
BASE_URL=https://your-server-domain.com
```

### Install & Run

```bash
# Install dependencies
cd client && npm install
cd ../server && npm install

# Run both (from root)
npm run dev

# Or separately
cd server && npm start
cd client && npm run dev
```

### Deploy

Frontend is deployed on **Vercel**, backend on **Railway**.

```bash
# Frontend
cd client && npx vercel --prod

# Backend
cd server && railway up . --path-as-root
```

## Live Demo

- **App**: https://krishisathi-rose.vercel.app
- **API**: https://passionate-alignment-production.up.railway.app

> **Note**: This project uses free-tier API plans (Gemini, Twilio trial). You may occasionally see rate-limit messages if the AI service is temporarily overloaded. Phone calls via "Call Me" only work to Twilio-verified numbers due to the trial account.

## What We Built During the Hackathon

- Full voice AI agent that works both in-app and over phone calls
- Real Twilio integration: SMS, WhatsApp, and voice calls actually deliver
- Multilingual crop advisory with AI generation in Hindi/Telugu
- Emergency broadcast system that reaches farmers through multiple channels
- Biometric (WebAuthn) login for farmers who struggle with passwords
- GPS-based auto-fill of district and state during registration
- Mobile-first PWA with offline-capable service worker

## Team

Built with a lot of chai, very little sleep, and an unreasonable belief that farmers deserve better tech.
